# **Split-step 方法推导**

## **抛物型波动方程**

光束传播遵循抛物型波动方程：
$\frac{\partial U(z,r)}{\partial z}=\frac{j}{2k}\left[\nabla^2+2k^2n(z,r)\right]U(z,r),$

其中，$U(z,r)$是复振幅场

$z$是传播方向坐标

$r$是横向坐标

$k=2π/λ$是真空波数

$n(z,r)$是随机折射率扰动(湍流)

### 分离变量法

将光场分解为横向拉普拉斯算子的本征函数展开：
$U(z,r)=\sum_nu_n(z)\phi_n(r)$

其中，$ϕn(r)$是拉普拉斯算子 $\nabla^{2}$ 的本征函数，满足$\nabla^2\phi_n(r)=\lambda_n^2\phi_n(r)$

**傅里叶变换是拉普拉斯变换的一个特例**。当拉普拉斯变换中的复数变量的实部为零时，拉普拉斯变换就退化为傅里叶变换。换句话说，傅里叶变换可以看作是在拉普拉斯变换的复平面上，沿着虚轴进行的特殊情况。

代入波动方程后，方程可拆分为两个独立部分：
自由空间传播项：
$\exp\left(\frac{j}{2k}\lambda_n^2\Delta z\right)$

描述光场在均匀介质中的相位变化。

湍流相位扰动项：
$\exp[jS(\Delta z,r)]$

其中，$S(\Delta z,r)=k\int_{\Delta z}n(z,r)dz$代表湍流引起的相位起伏。

综合上述两部分，光场在$z+Δz$处的解为：
$U(z+\Delta z,r)=\exp[jS(\Delta z,r)]\sum_nu_n(z)\exp\left(\frac{j}{2k}\lambda_n^2\Delta z\right)\phi_n(r)$

# **Split-step 方法的局限性**

1. 规则网格的依赖性

   Split-step 方法要求模拟空间划分为**均匀网格**。这是因为：

   - 傅里叶变换需要规则采样点
   - 网格划分大小$h_{m}$需通过误差公式平衡：

   ​	$\epsilon\leq\frac{1}{M}\sum_mh_m^2|\nabla^2U|$

2. 对复杂波前的不适应性

   - **湍流引起的波前畸变**：湍流会导致光场相位剧烈变化，规则网格可能无法在局部高曲率区域提供足够分辨率。
   - **计算资源浪费**：在平坦区域使用细网格会增加冗余计算，而规则网格无法动态调整分辨率。

3. **数值误差的累积**
   Split-step 方法将传播过程分解为多个小步，但每一步的误差会随传播距离累积，尤其在长距离传播时更为显著。

# **不规则网格的图模型**

本文提出利用**图论**构建**不规则自适应网格**，通过以下方式改进模拟：

1. **图的构建**：将光场和湍流视为图中的信号，顶点表示空间采样点，边表示点间关系。
2. **拉普拉斯矩阵**：用于离散化波动方程中的微分算子（如拉普拉斯算子），适应不规则网格。
3. **多图表示**：同一图中同时编码光场和湍流的属性，实现联合建模。

## 拉普拉斯矩阵

作用：

将连续空间中的微分方程（如波动方程）转化为图论框架下的离散形式。

在图中，通过拉普拉斯矩阵 $L=D−A$近似这一算子，将连续的二阶导数离散化为顶点间的差分形式。(其中 $D$ 是度矩阵，$A$是邻接矩阵)

- **连续拉普拉斯算子**：

  在连续空间中，拉普拉斯算子定义为$\nabla^{2}U=\frac{\partial^{2}U}{\partial x^{2}}+\frac{\partial^{2}U}{\partial y^{2}}$

- **离散拉普拉斯矩阵**：

  在图中，拉普拉斯矩阵通过邻接权重近似二阶导数：$(\nabla^2U)_n\approx\sum_mW_{nm}(U_n-U_m)$

  其中，$W_{nm}$是顶点$n$与$m$之间的权重。

## 多图表示：光场与湍流的联合建模

本文提出**多图表示** $\mathrm{}G=(V,E^{C},E^{\Gamma},W^{C},W^{\Gamma})$，同时编码光场 $U$ 和湍流 $S$ 的属性：

1. 光场图：
   - 边集$E^{C}$：连接每个顶点的最近邻，权重 $W^{C}$由余切公式计算。
   - 余切拉普拉斯矩阵：$L^C=\Phi\Lambda\Phi^T$，其中$\Phi$是特征向量矩阵，$\Lambda$是对应特征值矩阵。
2. 湍流图：
   - 边集$E^{\Gamma}$：连接所有顶点对，权重 $W^{\Gamma}$由湍流协方差函数$\Gamma_{s}(r_{1},r_{2})$决定。
   - 协方差拉普拉斯矩阵：$L^\Gamma=\Psi\Sigma\Psi^T$，其中$\Psi$是Karhunen-Loève基函数，$\Sigma$是对应的特征值对角矩阵。
   - 作用：生成随机湍流相位$S=\Psi^Ts_n$，其中$s_n$是独立高斯噪声向量。

# 三角形网格生成与自适应性

## 基于波前曲率的网格调整策略

连续拉普拉斯算子直接描述波前曲率，离散拉普拉斯矩阵（如余切权重）是其数值逼近。通过拉普拉斯算子的局部值（曲率）动态调整网格密度，平衡精度与计算效率。

### 操作细节

- 对于每条边，计算其两端顶点的法向量夹角 $\theta$：
  - 如果$\theta>\theta_{\max}$：进行边分裂
  - 如果 $\theta<\theta_{\min}$：进行边合并
  - $\text{顶点功率密度}<K\cdot\bar{P}$：删除
  - 同时进行 Delaunay 检查，确保三角网质量
- 在边中心插入新点时，用插值计算其坐标与波前复振幅。
  - **分割**：
    当边缘曲率过高时，沿中点分割边缘并插入新顶点，重新连接邻接顶点。新顶点的坐标和光场值通过插值计算。
  - **合并**：
    当边缘曲率过低时，移除该边缘及其关联顶点，将两端顶点合并（需通过 Delaunay 检查确保三角形质量）。新顶点的**空间坐标**取原两顶点的加权平均。

# 大致流程

1. 创建初始三角网格

   在一个二维区域（如单位圆）中，生成一组不规则分布的点，并通过 Delaunay 三角剖分生成初始三角网格。

   1. 点分步策略：Fibonacci螺旋法

      基于黄金比例（φ ≈ 1.618）的递归算法，生成一种**无规律但均匀填充空间**的点序列。其特点是：

      - 点分布具有**六边形密堆积特性**，局部密度高且无周期性；
      - 适用于模拟自然现象（如湍流），避免人为规则性引入的误差。

   2. 网格链接：Delaunay三角剖分

      **Delaunay准则**：
      任意三角形的外接圆内​**​不包含其他顶点​**​，从而避免狭长三角形，保证网格的几何质量。![](C:\Users\yuantec\AppData\Roaming\Typora\typora-user-images\image-20250508201203426.png)

2. 构建余切拉普拉斯矩阵

   1. 遍历三角形，找到所有包含边$(n,m)$的三角形

   2. 对每个相邻三角形，计算边$(n,m)$对应的两个内角$\alpha_{nm}$和$\beta_{nm}$

      权重赋值：定义为$W_{nm}=\cot\alpha_{nm}+\cot\beta_{nm}$![](C:\Users\yuantec\AppData\Roaming\Typora\typora-user-images\image-20250508191930423.png)

   3. 构建度矩阵和邻接矩阵

      - 度矩阵$D$:对角矩阵，对角线元素为顶点 $n$的总权重：

        $D_{nn}=\sum_mW_{nm}$

      - 邻接矩阵$A$:

        非对角线元素为边权重$W_{nm}$，对角线元素为0。

   4. 组合拉普拉斯矩阵

      最终，Cotangent Laplacian 矩阵为：

      $L^C=D-A$

      而后进行本征分解：
      $L^C=\Phi\Lambda\Phi^T$	

3. 构建协方差图

   用于在图上生成**具有统计特性**的相位扰动 $S$，模拟湍流相位屏。

   $S(\mathbf{r})=\sum_ns_n\psi_n(\mathbf{r})$

   - 使用湍流协方差函数（Kolmogorov）：

     $\Gamma_s(\mathbf{r}_1,\mathbf{r}_2)=\left(\frac{|\mathbf{r}_1-\mathbf{r}_2|}{r_c}\right)^\alpha$

   - 构建稠密矩阵 $\Gamma$，然后变换成 Laplacian：

     $L_\Gamma=D-\Gamma$

   - 对 $L_{\Gamma}$做本征分解：

     $L^\Gamma=\Psi\Sigma\Psi^T$

     - 用于 Karhunen-Loève 展开：
     
      $S=\Psi^Ts_n\quad\text{其中}s_n\sim\mathcal{N}(0,\sigma_n^2)$

4. 构建初始光场

   例如一个高斯光束

   $U_0(r)=\exp\left(-\frac{|r|^2}{2\omega_0^2}\right)$

   投影到图拉普拉斯本征向量上得初始谱系数$u_n(0)$：

   $u_n(0)=\phi_n^TU_0$

5. Split-Step 光场传播

   1. 每个谱分量乘一个传播因子：

      $u_n(z+\Delta z)\leftarrow u_n(z)\cdot\exp\left(\frac{j\Delta z}{2k}\lambda_n^2\right)$

   2. 将相位扰动场$S$映射回空间域，加在光场上：

      $U(z+\Delta z,r)=\Phi u_n(z+\Delta z)\cdot\exp(jS)$

6. 动态自适应网格

   当传播到一定距离，波前曲率增大，需要重构网格。

   具体操作如上文所讲，并对新网格重新构建$L_{C}$,$L_{\Gamma}$并重投影光场。